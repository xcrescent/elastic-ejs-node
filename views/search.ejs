<%
const searchBody = `
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">üîç Search Ads</h1>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12">
        <form method="GET" action="/search">
            <div class="input-group mb-3">
                <input type="text" class="form-control form-control-lg"
                       name="q" value="${query}" placeholder="Search ads...">
                <button class="btn btn-primary" type="submit">üîç Search</button>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <select name="size" class="form-select">
                        <option value="10" ${size === 10 ? 'selected' : ''}>10 results</option>
                        <option value="25" ${size === 25 ? 'selected' : ''}>25 results</option>
                        <option value="50" ${size === 50 ? 'selected' : ''}>50 results</option>
                        <option value="100" ${size === 100 ? 'selected' : ''}>100 results</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <button type="submit" class="btn btn-outline-primary">Update Results</button>
                </div>
            </div>
        </form>
    </div>
</div>

${result.success ? `
<div class="row mb-3">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <h5>Found ${result.total.toLocaleString()} results</h5>
            ${totalPages > 1 ? `
            <nav>
                <ul class="pagination mb-0">
                    ${page > 1 ? `<li class="page-item"><a class="page-link" href="/search?q=${encodeURIComponent(query)}&size=${size}&page=${page-1}">Previous</a></li>` : ''}
                    ${Array.from({length: Math.min(5, totalPages)}, (_, i) => {
    const pageNum = Math.max(1, page - 2) + i;
    if (pageNum <= totalPages) {
        return `<li class="page-item ${pageNum === page ? 'active' : ''}">
                                <a class="page-link" href="/search?q=${encodeURIComponent(query)}&size=${size}&page=${pageNum}">${pageNum}</a>
                            </li>`;
    }
    return '';
}).join('')}
                    ${page < totalPages ? `<li class="page-item"><a class="page-link" href="/search?q=${encodeURIComponent(query)}&size=${size}&page=${page+1}">Next</a></li>` : ''}
                </ul>
            </nav>
            ` : ''}
        </div>
    </div>
</div>

${result.data.hits.length > 0 ? `
<div class="row">
    <div class="col-12">
        ${result.data.hits.map((hit, index) => `
        <div class="card mb-3 result-item">
            <div class="card-header d-flex justify-content-between">
                <strong>Document ID: ${hit._id}</strong>
                <span class="badge bg-primary">Score: ${hit._score}</span>
            </div>
            <div class="card-body">
                <div class="json-viewer">
                    <pre><code class="language-json">${JSON.stringify(hit._source, null, 2)}</code></pre>
                </div>
            </div>
        </div>
        `).join('')}
    </div>
</div>
` : '<div class="alert alert-info">No documents found matching your search.</div>'}

` : `
<div class="alert alert-danger">
    <strong>Error:</strong> ${result.error}
</div>
`}
`;
%>
<%- include('layout', { body: searchBody, title: 'Search - Elasticsearch Query System' }) %>
